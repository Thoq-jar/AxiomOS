<script lang="js">
    document.addEventListener("DOMContentLoaded", () => {
        document.getElementById("commandBar").addEventListener("keydown", (event) => {
            if (event.key === "Enter") {
                runCommand(event.target.value);
            }
        });

        function runCommand(command) {
            fetch('/api/command', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    command: command
                })
            })
            .then(response => {
                if (!response.ok) {
                    if (response.status === 403) {
                        const arg0 = command.split(' ')[0];
                        throw new Error(`Command not allowed: ${arg0}`);
                    }
                    throw new Error(`HTTP error! response: ${response.status} ${response.url}`);
                }
                return response.json();
            })
            .then(data => {
                if (data.error) {
                    alert(`Error: ${data.error}`);
                } else {
                    alert(`Output: ${data.output}`);
                }
            })
            .catch(error => {
                alert(`Request failed: ${error.message}`);
            });

            document.getElementById("commandBar").value = "";
        }
    });
</script>

<div data-widget="shell">
    <div class="rounded-lg w-fit h-fit px-3 py-3 backdrop-blur-lg shadow-black shadow-2xl font-sans font-extralight">
        <label for="search" class="text-2xl">
            <input type="text"
                   id="commandBar"
                   class="w-[50vw] text-2xl border-none outline-none 
                          focus:outline-none focus:border-none focus:ring-0 bg-transparent"
                   autocomplete="off"
                   autocapitalize="off"
                   spellcheck="false"
                   placeholder="Enter a shell command..."/>
        </label>
    </div>
</div>
